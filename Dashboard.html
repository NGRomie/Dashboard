<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Student Engagement Dashboard - University of Arizona Think Tank</title>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/Chart.js/3.9.1/chart.min.js"></script>
    <style>
        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
        }

        body {
            font-family: 'Segoe UI', Tahoma, Geneva, Verdana, sans-serif;
            background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
            min-height: 100vh;
            padding: 20px;
        }

        .dashboard-header {
            background: white;
            border-radius: 15px;
            padding: 30px;
            margin-bottom: 30px;
            box-shadow: 0 10px 30px rgba(0,0,0,0.1);
            text-align: center;
        }

        .dashboard-header h1 {
            color: #2c3e50;
            font-size: 2.5em;
            margin-bottom: 10px;
        }

        .dashboard-header p {
            color: #7f8c8d;
            font-size: 1.2em;
        }
      

        .stats-grid {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(250px, 1fr));
            gap: 20px;
            margin-bottom: 30px;
        }

        .stat-card {
            background: white;
            border-radius: 15px;
            padding: 25px;
            text-align: center;
            box-shadow: 0 10px 30px rgba(0,0,0,0.1);
            transition: transform 0.3s ease;
        }

        .stat-card:hover {
            transform: translateY(-5px);
        }

        .stat-number {
            font-size: 3em;
            font-weight: bold;
            margin-bottom: 10px;
        }

        .stat-label {
            font-size: 1.1em;
            color: #7f8c8d;
            text-transform: uppercase;
            letter-spacing: 1px;
        }

        .green { color: #27ae60; }
        .yellow { color: #f39c12; }
        .red { color: #e74c3c; }

        .charts-grid {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(400px, 1fr));
            gap: 30px;
            margin-bottom: 30px;
        }

        .chart-container {
            background: white;
            border-radius: 15px;
            padding: 25px;
            box-shadow: 0 10px 30px rgba(0,0,0,0.1);
        }

        .chart-title {
            font-size: 1.4em;
            color: #2c3e50;
            margin-bottom: 20px;
            text-align: center;
        }

        .student-list {
            background: white;
            border-radius: 15px;
            padding: 25px;
            box-shadow: 0 10px 30px rgba(0,0,0,0.1);
        }

        .section-title {
            font-size: 1.8em;
            color: #2c3e50;
            margin-bottom: 25px;
            text-align: center;
        }

        .student-item {
            display: flex;
            align-items: center;
            padding: 15px;
            margin-bottom: 15px;
            border-radius: 10px;
            transition: all 0.3s ease;
            cursor: pointer;
        }

        .student-item:hover {
            transform: translateX(5px);
            box-shadow: 0 5px 15px rgba(0,0,0,0.1);
        }

        .student-red { background: #fdf2f2; border-left: 5px solid #e74c3c; }
        .student-yellow { background: #fefcf0; border-left: 5px solid #f39c12; }
        .student-green { background: #f0f9f4; border-left: 5px solid #27ae60; }

        .student-status {
            font-size: 1.5em;
            margin-right: 15px;
            width: 30px;
        }

        .student-info {
            flex: 1;
        }

        .student-name {
            font-size: 1.2em;
            font-weight: bold;
            margin-bottom: 5px;
        }

        .student-details {
            color: #7f8c8d;
            font-size: 0.9em;
        }

        .student-score {
            font-size: 1.5em;
            font-weight: bold;
            margin-left: 15px;
        }

        .filters {
            background: white;
            border-radius: 15px;
            padding: 20px;
            margin-bottom: 30px;
            box-shadow: 0 10px 30px rgba(0,0,0,0.1);
            display: flex;
            gap: 15px;
            align-items: center;
            flex-wrap: wrap;
        }

        .filter-label {
            font-weight: bold;
            color: #2c3e50;
        }

        .filter-button {
            padding: 10px 20px;
            border: none;
            border-radius: 25px;
            cursor: pointer;
            font-weight: bold;
            transition: all 0.3s ease;
        }

        .filter-active {
            background: #3498db;
            color: white;
        }

        .filter-inactive {
            background: #ecf0f1;
            color: #7f8c8d;
        }

        .filter-button:hover {
            transform: translateY(-2px);
        }

        .last-updated {
            text-align: center;
            color: #7f8c8d;
            font-style: italic;
            margin-top: 20px;
        }

        .quote-box {
            background: #f8f9fa;
            border-left: 4px solid #3498db;
            padding: 15px;
            margin: 10px 0;
            border-radius: 5px;
            font-style: italic;
        }

        .quote-box::before {
            content: '"';
            font-size: 1.5em;
            color: #3498db;
        }

        .quote-box::after {
            content: '"';
            font-size: 1.5em;
            color: #3498db;
        }

        @media (max-width: 768px) {
            .dashboard-header h1 {
                font-size: 2em;
            }
            
            .charts-grid {
                grid-template-columns: 1fr;
            }
            
            .student-item {
                flex-direction: column;
                text-align: center;
            }
        }
        .student-grid {
    display: grid;
    grid-template-columns: repeat(auto-fit, minmax(240px, 1fr));
    gap: 18px;
}
.student-card {
    background: #f7f9fc;
    border-radius: 12px;
    padding: 18px;
    box-shadow: 0 6px 16px rgba(0,0,0,0.08);
    cursor: pointer;
    transition: transform 0.2s;
    text-align: center;
    border-left: 5px solid transparent;
}
.student-card.student-green { border-left-color: #27ae60; }
.student-card.student-yellow { border-left-color: #f39c12; }
.student-card.student-red { border-left-color: #e74c3c; }
.student-card:hover {
    transform: translateY(-3px) scale(1.03);
}
#studentFormModal input[type="text"],
#studentFormModal input[type="number"] {
    font-size: 1em;
    padding: 7px 12px;
    border: 1px solid #ccc;
    border-radius: 6px;
    margin-bottom: 6px;
    background: #f4f7fa;
}
#studentFormModal label {
    font-weight: bold;
    color: #2c3e50;
}
        #milestoneTimelineWrapper {
          background: #fff;
          border-radius: 15px;
          margin-bottom: 28px;
          box-shadow: 0 5px 18px rgba(0,0,0,0.08);
          padding: 16px 18px;
          overflow-x: auto;
          overflow-y: visible;
          height: 120px;
        }
.timeline-controls {
  display: flex;
  gap: 15px;
  margin-bottom: 10px;
  align-items: center;
}
        .milestone-timeline {
          position: relative;
          min-width: 900px;
          height: 100%;
          box-sizing: border-box;
          background-image: repeating-linear-gradient(
            to right,
            transparent,
            transparent calc(100% / 16 - 1px),
            #ccc calc(100% / 16 - 1px),
            #ccc calc(100% / 16)
          );
          background-repeat: no-repeat;
          background-size: 100% 100%;
        }
        .timeline-track {
          position: absolute;
          left: 0; right: 0;
          top: 50%;
          transform: translateY(-50%);
          height: 2px;
          background: rgba(12,35,75,0.92);
          border-radius: 1px;
          z-index: 0;
        }
        .timeline-band {
          position: absolute;
          top: 50%;
          transform: translateY(-50%);
          height: 2px;
          border-radius: 1px;
          background: rgba(255,215,0,0.6);
          z-index: 1;
        }
        .timeline-dot {
          position: absolute;
          top: 50%;
          transform: translate(-50%, -50%);
          width: 20px; height: 20px;
          border-radius: 50%;
          background: #AB0520;
          border: 2px solid #fff;
          box-shadow: 0 0 6px rgba(0,0,0,0.2);
          display: flex;
          align-items: center;
          justify-content: center;
          font-size: 0.9em;
          color: #fff;
          z-index: 2;
        }

        /* Timeline dot hover popover */
        .timeline-dot .popover {
          display: none;
          position: absolute;
          left: 50%;
          transform: translateX(-50%);
          bottom: 100%;
          margin-bottom: 6px;
          background: #fff;
          color: #071C3B;
          padding: 6px 10px;
          border-radius: 6px;
          box-shadow: 0 4px 12px rgba(0,0,0,0.15);
          white-space: nowrap;
          z-index: 5;
          font-size: 0.9em;
        }
        .timeline-dot:hover .popover {
          display: block;
        }


</style>
<script>
  document.addEventListener('DOMContentLoaded', () => {
    const wrapper = document.getElementById('milestoneTimelineWrapper');
    const track = document.querySelector('.timeline-track');
    const dots = document.querySelectorAll('.timeline-dot');
    // Center the track and dots vertically
    const wrapperHeight = wrapper.clientHeight;
    const centerY = wrapperHeight / 2;
    if (track) {
      track.style.top = centerY + 'px';
      track.style.transform = 'translateY(-50%)';
    }
    dots.forEach(dot => {
      dot.style.top = centerY + 'px';
      dot.style.transform = 'translate(-50%, -50%)';
    });
  });
</script>
</head>
    <body>
    <div class="dashboard-header">
        <h1>🎯 Student Engagement Dashboard</h1>
        <p>University of Arizona Think Tank • Proactive Student Support System</p>
    </div>
<!-- Horizontal Timeline Prototype -->
<div id="milestoneTimelineWrapper">
  <div class="timeline-controls">
    <button class="filter-button filter-active" onclick="filterTimelineEvents('all'); updateTimelineControls(this)">All Events</button>
    <button class="filter-button filter-inactive" onclick="filterTimelineEvents('registration'); updateTimelineControls(this)">Registration</button>
    <button class="filter-button filter-inactive" onclick="filterTimelineEvents('exam'); updateTimelineControls(this)">Exam</button>
    <button class="filter-button filter-inactive" onclick="filterTimelineEvents('holiday'); updateTimelineControls(this)">Holiday</button>
    <button class="filter-button filter-inactive" onclick="filterTimelineEvents('outreach'); updateTimelineControls(this)">Outreach</button>
    <button class="filter-button filter-inactive" onclick="filterTimelineEvents('custom'); updateTimelineControls(this)">Custom</button>
    <button class="filter-button filter-active" style="margin-left:auto;" onclick="addCustomTimelineEvent()">+ Add Event</button>
  </div>
  <div id="milestoneTimeline" class="milestone-timeline"></div>
</div>
    <div class="stats-grid">
        <div class="stat-card">
            <div class="stat-number green" id="greenCount">0</div>
            <div class="stat-label">Doing Well</div>
        </div>
        <div class="stat-card">
            <div class="stat-number yellow" id="yellowCount">0</div>
            <div class="stat-label">Need Attention</div>
        </div>
        <div class="stat-card">
            <div class="stat-number red" id="redCount">0</div>
            <div class="stat-label">Immediate Action</div>
        </div>
        <div class="stat-card">
            <div class="stat-number" style="color: #3498db;" id="totalCount">0</div>
            <div class="stat-label">Total Students</div>
        </div>
    </div>

    <div class="charts-grid">
        <div class="chart-container">
            <div class="chart-title">Student Status Distribution</div>
            <canvas id="statusChart"></canvas>
        </div>
        <div class="chart-container">
            <div class="chart-title">Grade Distribution</div>
            <canvas id="gradeChart"></canvas>
        </div>
        <div class="chart-container">
            <div class="chart-title">Survey Sentiment Analysis</div>
            <canvas id="sentimentChart"></canvas>
        </div>
        <div class="chart-container">
            <div class="chart-title">ALEKS Engagement vs Performance</div>
            <canvas id="aleksChart"></canvas>
        </div>
        <div class="chart-container">
            <div class="chart-title">Think Tank Utilization</div>
            <canvas id="thinkTankChart"></canvas>
        </div>
    </div>

    <div class="filters">
        <span class="filter-label">Show Students:</span>
        <button class="filter-button filter-active" onclick="filterStudents('all')">All Students</button>
        <button class="filter-button filter-inactive" onclick="filterStudents('red')">🔴 Immediate Action</button>
        <button class="filter-button filter-inactive" onclick="filterStudents('yellow')">🟡 Need Attention</button>
        <button class="filter-button filter-inactive" onclick="filterStudents('green')">🟢 Doing Well</button>
        <div style="margin-left: auto; display: flex; gap: 10px; align-items: center;">
            <span class="filter-label">View:</span>
            <button class="filter-button filter-active" id="listViewBtn" onclick="toggleView('list')">📋 List</button>
            <button class="filter-button filter-inactive" id="gridViewBtn" onclick="toggleView('grid')">⊞ Grid</button>
        </div>
    </div>
    <div style="display: flex; justify-content: flex-end; margin-bottom: 10px;">
        <button class="filter-button filter-active" onclick="openStudentForm()">+ Add Student</button>
    </div>
    <div class="student-list">
        <div class="section-title">Student Priority List</div>
        <div id="studentContainer"></div>
    </div>

    <!-- Student Profile Modal - This is the popup that shows when you click on a student -->
    <div id="studentProfileModal" style="display: none; position: fixed; top: 0; left: 0; width: 100%; height: 100%; background-color: rgba(0,0,0,0.7); z-index: 1000;">
        <div style="position: relative; width: 80%; max-width: 900px; margin: 50px auto; background: white; border-radius: 15px; padding: 30px; box-shadow: 0 10px 30px rgba(0,0,0,0.3); max-height: 90vh; overflow-y: auto;">
            <button onclick="closeStudentProfile()" style="position: absolute; top: 15px; right: 15px; background: none; border: none; font-size: 24px; cursor: pointer;">×</button>
            <div id="studentProfileContent">
                <!-- Student profile content will be injected here -->
            </div>
        </div>
    </div>
<!-- Student Form Modal (Add/Edit) -->
<div id="studentFormModal" style="display: none; position: fixed; top: 0; left: 0; width: 100%; height: 100%; background-color: rgba(0,0,0,0.7); z-index: 1100;">
    <div style="position: relative; width: 90%; max-width: 500px; margin: 80px auto; background: white; border-radius: 15px; padding: 30px;">
        <button onclick="closeStudentForm()" style="position: absolute; top: 15px; right: 15px; background: none; border: none; font-size: 24px; cursor: pointer;">×</button>
        <h2 id="studentFormTitle" style="margin-bottom: 20px;">Add Student</h2>
        <form id="studentForm" onsubmit="saveStudent(event)">
            <input type="hidden" id="formStudentId">
            <label>First Name:</label>
            <input type="text" id="formFirstName" required style="width:100%;margin-bottom:10px;"><br>
            <label>Last Name:</label>
            <input type="text" id="formLastName" required style="width:100%;margin-bottom:10px;"><br>
            <label>Grade (%):</label>
            <input type="number" id="formGrade" min="0" max="100" required style="width:100%;margin-bottom:10px;"><br>
            <label>ALEKS Days:</label>
            <input type="number" id="formAleksDays" min="0" required style="width:100%;margin-bottom:10px;"><br>
            <label>ALEKS Topics:</label>
            <input type="number" id="formAleksTopics" min="0" required style="width:100%;margin-bottom:10px;"><br>
            <label>Think Tank Visits:</label>
            <input type="number" id="formThinkTankVisits" min="0" required style="width:100%;margin-bottom:10px;"><br>
            <label>Stress (1-10):</label>
            <input type="number" id="formStress" min="1" max="10" required style="width:100%;margin-bottom:10px;"><br>
            <label>Confidence (1-10):</label>
            <input type="number" id="formConfidence" min="1" max="10" required style="width:100%;margin-bottom:10px;"><br>
            <label>Wellness (1-100):</label>
            <input type="number" id="formWellness" min="1" max="100" required style="width:100%;margin-bottom:10px;"><br>
            <button type="submit" class="filter-button filter-active" style="width:100%;margin-top:10px;">Save Student</button>
        </form>
    </div>
</div>
    <div class="last-updated">
        Last updated: <span id="lastUpdated"></span>
    </div>
        <script>
        // Generate sample student data
        const firstNames = ['Emma', 'Liam', 'Olivia', 'Noah', 'Ava', 'Ethan', 'Sophia', 'Mason', 'Isabella', 'William',
                           'Mia', 'James', 'Charlotte', 'Benjamin', 'Amelia', 'Lucas', 'Harper', 'Henry', 'Evelyn', 'Alexander'];
        const lastNames = ['Johnson', 'Williams', 'Brown', 'Jones', 'Garcia', 'Miller', 'Davis', 'Rodriguez', 'Martinez', 'Hernandez'];

        // Survey response templates for generating realistic quotes
        const surveyQuotes = {
            stress: {
                high: [
                    "I feel overwhelmed with everything I have to do",
                    "I'm having trouble sleeping because I worry about school",
                    "The workload feels impossible to manage",
                    "I panic when I think about upcoming exams",
                    "I can't focus because I'm so anxious all the time",
                    "Everything feels like it's piling up and I can't catch up",
                    "I feel like I'm drowning in assignments",
                    "The pressure is making it hard to eat or sleep normally"
                ],
                medium: [
                    "Some days are harder than others to manage",
                    "I feel stressed but I'm trying to cope",
                    "School is challenging but I think I can handle it",
                    "I worry sometimes but not constantly",
                    "The workload is manageable most of the time",
                    "I have stressful moments but they pass",
                    "I feel pressure but I'm learning to deal with it"
                ],
                low: [
                    "I feel pretty calm about school overall",
                    "I'm managing my stress well this semester",
                    "School feels challenging but not overwhelming",
                    "I have good strategies for dealing with pressure",
                    "I feel balanced and in control",
                    "Even when things get busy, I stay pretty relaxed",
                    "I'm confident in my ability to handle challenges"
                ]
            },
            confidence: {
                high: [
                    "I believe I can succeed in my classes",
                    "I feel prepared for the challenges ahead",
                    "I trust my ability to learn new material",
                    "I'm confident I can achieve my academic goals",
                    "I feel capable of handling difficult coursework",
                    "I believe in my potential to do well",
                    "I feel ready to tackle whatever comes my way"
                ],
                medium: [
                    "I think I can probably do well if I work hard",
                    "Some subjects feel easier than others for me",
                    "I have moments where I doubt myself but mostly feel okay",
                    "I'm learning to believe in myself more",
                    "My confidence varies depending on the subject",
                    "I feel capable some days, uncertain others",
                    "I'm working on building my self-confidence"
                ],
                low: [
                    "I don't think I'm smart enough for college",
                    "I worry I'm not cut out for this",
                    "Everyone else seems to understand things better than me",
                    "I feel like I'm falling behind everyone",
                    "I don't think I belong here",
                    "I'm afraid I'm going to fail",
                    "I doubt my ability to succeed academically"
                ]
            }
        };

        function generateStudentData() {
            const students = [];
            for (let i = 0; i < 50; i++) {
                const firstName = firstNames[Math.floor(Math.random() * firstNames.length)];
                const lastName = lastNames[Math.floor(Math.random() * lastNames.length)];
                const studentType = Math.random() < 0.2 ? 'struggling' : Math.random() < 0.7 ? 'average' : 'excelling';
                
                let grade, aleksDays, aleksTopics, thinkTankVisits, stress, confidence, wellness;
                
                if (studentType === 'struggling') {
                    grade = 40 + Math.random() * 25;
                    aleksDays = 5 + Math.floor(Math.random() * 10);
                    aleksTopics = Math.floor(Math.random() * 15);
                    thinkTankVisits = Math.floor(Math.random() * 3);
                    stress = 7 + Math.floor(Math.random() * 4);
                    confidence = 1 + Math.floor(Math.random() * 4);
                    wellness = 20 + Math.random() * 40;
                } else if (studentType === 'excelling') {
                    grade = 85 + Math.random() * 13;
                    aleksDays = Math.floor(Math.random() * 3);
                    aleksTopics = 25 + Math.floor(Math.random() * 15);
                    thinkTankVisits = 2 + Math.floor(Math.random() * 5);
                    stress = 1 + Math.floor(Math.random() * 5);
                    confidence = 7 + Math.floor(Math.random() * 4);
                    wellness = 80 + Math.random() * 20;
                } else {
                    grade = 70 + Math.random() * 15;
                    aleksDays = 1 + Math.floor(Math.random() * 4);
                    aleksTopics = 15 + Math.floor(Math.random() * 10);
                    thinkTankVisits = 1 + Math.floor(Math.random() * 4);
                    stress = 3 + Math.floor(Math.random() * 5);
                    confidence = 5 + Math.floor(Math.random() * 4);
                    wellness = 60 + Math.random() * 20;
                }

                const status = wellness >= 80 ? 'green' : wellness >= 60 ? 'yellow' : 'red';
                const statusEmoji = status === 'green' ? '🟢' : status === 'yellow' ? '🟡' : '🔴';

                // Generate sentiment score based on stress and confidence
                const sentimentScore = Math.max(1, Math.min(10, (11 - stress + confidence) / 2));

                // Generate survey quotes
                const stressLevel = stress >= 8 ? 'high' : stress >= 5 ? 'medium' : 'low';
                const confidenceLevel = confidence >= 8 ? 'high' : confidence >= 5 ? 'medium' : 'low';
                
                const stressQuote = surveyQuotes.stress[stressLevel][Math.floor(Math.random() * surveyQuotes.stress[stressLevel].length)];
                const confidenceQuote = surveyQuotes.confidence[confidenceLevel][Math.floor(Math.random() * surveyQuotes.confidence[confidenceLevel].length)];

                students.push({
                    id: `UA${1000 + i}`,
                    firstName,
                    lastName,
                    fullName: `${firstName} ${lastName}`,
                    grade: Math.round(grade * 10) / 10,
                    aleksDays: Math.floor(aleksDays),
                    aleksTopics: Math.floor(aleksTopics),
                    thinkTankVisits: Math.floor(thinkTankVisits),
                    stress: Math.floor(stress),
                    confidence: Math.floor(confidence),
                    wellness: Math.round(wellness * 10) / 10,
                    status,
                    statusEmoji,
                    type: studentType,
                    sentimentScore: Math.round(sentimentScore * 10) / 10,
                    stressQuote,
                    confidenceQuote
                });
            }
            return students.sort((a, b) => a.wellness - b.wellness);
        }

        const students = generateStudentData();
        let currentFilter = 'all';
        let currentView = 'list'; // Default view is list

        // Update statistics
        function updateStats() {
            const green = students.filter(s => s.status === 'green').length;
            const yellow = students.filter(s => s.status === 'yellow').length;
            const red = students.filter(s => s.status === 'red').length;
            
            document.getElementById('greenCount').textContent = green;
            document.getElementById('yellowCount').textContent = yellow;
            document.getElementById('redCount').textContent = red;
            document.getElementById('totalCount').textContent = students.length;
        }
                    // Create charts
        function createCharts() {
            // Status pie chart
            const statusCtx = document.getElementById('statusChart').getContext('2d');
            new Chart(statusCtx, {
                type: 'doughnut',
                data: {
                    labels: ['Doing Well', 'Need Attention', 'Immediate Action'],
                    datasets: [{
                        data: [
                            students.filter(s => s.status === 'green').length,
                            students.filter(s => s.status === 'yellow').length,
                            students.filter(s => s.status === 'red').length
                        ],
                        backgroundColor: ['#27ae60', '#f39c12', '#e74c3c'],
                        borderWidth: 0
                    }]
                },
                options: {
                    responsive: true,
                    plugins: {
                        legend: {
                            position: 'bottom'
                        }
                    }
                }
            });

            // Grade histogram
            const gradeCtx = document.getElementById('gradeChart').getContext('2d');
            const gradeBins = Array(10).fill(0);
            students.forEach(s => {
                const bin = Math.min(9, Math.floor(s.grade / 10));
                gradeBins[bin]++;
            });

            new Chart(gradeCtx, {
                type: 'bar',
                data: {
                    labels: ['0-10', '10-20', '20-30', '30-40', '40-50', '50-60', '60-70', '70-80', '80-90', '90-100'],
                    datasets: [{
                        label: 'Number of Students',
                        data: gradeBins,
                        backgroundColor: '#3498db',
                        borderRadius: 5
                    }]
                },
                options: {
                    responsive: true,
                    plugins: {
                        legend: {
                            display: false
                        }
                    },
                    scales: {
                        y: {
                            beginAtZero: true
                        }
                    }
                }
            });

            // Survey Sentiment Analysis Chart
            const sentimentCtx = document.getElementById('sentimentChart').getContext('2d');
            const sentimentBins = Array(10).fill(0);
            students.forEach(s => {
                const bin = Math.min(9, Math.floor(s.sentimentScore));
                sentimentBins[bin]++;
            });

            new Chart(sentimentCtx, {
                type: 'bar',
                data: {
                    labels: ['1-2', '2-3', '3-4', '4-5', '5-6', '6-7', '7-8', '8-9', '9-10', '10'],
                    datasets: [{
                        label: 'Number of Students',
                        data: sentimentBins,
                        backgroundColor: [
                            '#e74c3c', '#e67e22', '#f39c12', '#f1c40f', '#ffeb3b',
                            '#cddc39', '#8bc34a', '#4caf50', '#2ecc71', '#27ae60'
                        ],
                        borderRadius: 5
                    }]
                },
                options: {
                    responsive: true,
                    plugins: {
                        legend: {
                            display: false
                        }
                    },
                    scales: {
                        x: {
                            title: {
                                display: true,
                                text: 'Sentiment Score (1=Very Negative, 10=Very Positive)'
                            }
                        },
                        y: {
                            beginAtZero: true,
                            title: {
                                display: true,
                                text: 'Number of Students'
                            }
                        }
                    }
                }
            });

            // ALEKS scatter plot
            const aleksCtx = document.getElementById('aleksChart').getContext('2d');
            new Chart(aleksCtx, {
                type: 'scatter',
                data: {
                    datasets: [{
                        label: 'Students',
                        data: students.map(s => ({
                            x: s.aleksDays,
                            y: s.aleksTopics,
                            backgroundColor: s.status === 'green' ? '#27ae60' : s.status === 'yellow' ? '#f39c12' : '#e74c3c'
                        })),
                        backgroundColor: students.map(s => s.status === 'green' ? '#27ae60' : s.status === 'yellow' ? '#f39c12' : '#e74c3c')
                    }]
                },
                options: {
                    responsive: true,
                    plugins: {
                        legend: {
                            display: false
                        }
                    },
                    scales: {
                        x: {
                            title: {
                                display: true,
                                text: 'Days Since Last ALEKS Login'
                            }
                        },
                        y: {
                            title: {
                                display: true,
                                text: 'ALEKS Topics Completed'
                            }
                        }
                    }
                }
            });

            // Think Tank utilization
            const thinkTankCtx = document.getElementById('thinkTankChart').getContext('2d');
            const thinkTankData = {
                'Doing Well': students.filter(s => s.status === 'green').reduce((sum, s) => sum + s.thinkTankVisits, 0) / students.filter(s => s.status === 'green').length || 0,
                'Need Attention': students.filter(s => s.status === 'yellow').reduce((sum, s) => sum + s.thinkTankVisits, 0) / students.filter(s => s.status === 'yellow').length || 0,
                'Immediate Action': students.filter(s => s.status === 'red').reduce((sum, s) => sum + s.thinkTankVisits, 0) / students.filter(s => s.status === 'red').length || 0
            };

            new Chart(thinkTankCtx, {
                type: 'bar',
                data: {
                    labels: Object.keys(thinkTankData),
                    datasets: [{
                        label: 'Average Visits per Month',
                        data: Object.values(thinkTankData),
                        backgroundColor: ['#27ae60', '#f39c12', '#e74c3c'],
                        borderRadius: 5
                    }]
                },
                options: {
                    responsive: true,
                    plugins: {
                        legend: {
                            display: false
                        }
                    },
                    scales: {
                        y: {
                            beginAtZero: true,
                            title: {
                                display: true,
                                text: 'Average Visits'
                            }
                        }
                    }
                }
            });
        }
                    // Display students
                    function displayStudents(filter = 'all') {
    const container = document.getElementById('studentContainer');
    const filteredStudents = filter === 'all' ? students : students.filter(s => s.status === filter);

    if (currentView === 'list') {
        // List view
        container.innerHTML = filteredStudents.map(student => {
            const concerns = [];
            if (student.grade < 70) concerns.push(`Grade: ${student.grade}%`);
            if (student.aleksDays > 3) concerns.push(`${student.aleksDays} days since ALEKS`);
            if (student.stress > 7) concerns.push('High stress');
            if (student.confidence < 5) concerns.push('Low confidence');
            if (student.thinkTankVisits === 0) concerns.push('No Think Tank visits');
            return `
                <div class="student-item student-${student.status}" onclick="showStudentProfile('${student.id}')">
                    <div class="student-status">${student.statusEmoji}</div>
                    <div class="student-info">
                        <div class="student-name">${student.fullName}</div>
                        <div class="student-details">
                            ${concerns.length > 0 ? concerns.join(' • ') : 'All indicators positive'}
                        </div>
                    </div>
                    <div class="student-score" style="color: ${student.status === 'green' ? '#27ae60' : student.status === 'yellow' ? '#f39c12' : '#e74c3c'}">
                        ${student.wellness}
                    </div>
                </div>
            `;
        }).join('');
    } else {
        // Grid view
        container.innerHTML = `
            <div class="student-grid">
                ${filteredStudents.map(student => `
                    <div class="student-card student-${student.status}" onclick="showStudentProfile('${student.id}')">
                        <div class="student-status" style="font-size:2em;">${student.statusEmoji}</div>
                        <div class="student-name" style="margin: 8px 0 4px 0; font-weight:bold;">${student.fullName}</div>
                        <div style="color:#7f8c8d; font-size:0.95em; margin-bottom:6px;">${student.grade}% • ${student.wellness}/100</div>
                        <div class="student-score" style="font-size:1.3em; color:${student.status === 'green' ? '#27ae60' : student.status === 'yellow' ? '#f39c12' : '#e74c3c'}">${student.type.charAt(0).toUpperCase() + student.type.slice(1)}</div>
                    </div>
                `).join('')}
            </div>
        `;
    }
}

        // Filter functionality
        function filterStudents(filter) {
            currentFilter = filter;
            displayStudents(filter);
            
            // Update button states
            document.querySelectorAll('.filter-button').forEach(btn => {
                btn.classList.remove('filter-active');
                btn.classList.add('filter-inactive');
            });
            event.target.classList.remove('filter-inactive');
            event.target.classList.add('filter-active');
        }
                    // Show student profile when clicked
        function showStudentProfile(studentId) {
            const student = students.find(s => s.id === studentId);
            if (!student) return;
            
            // Generate attendance data
            const attendanceDates = [];
            const attendanceData = [];
            const today = new Date();
            for (let i = 0; i < 14; i++) {
                const date = new Date();
                date.setDate(today.getDate() - (13 - i));
                attendanceDates.push(date.toLocaleDateString('en-US', {month: 'short', day: 'numeric'}));
                // For simplicity, generate random attendance but weight based on student type
                const attended = student.type === 'struggling' ? Math.random() > 0.4 : 
                                student.type === 'average' ? Math.random() > 0.2 : 
                                Math.random() > 0.1;
                attendanceData.push(attended ? 1 : 0);
            }
            
            // Generate ALEKS activity data
            const aleksDates = [];
            const aleksData = [];
            for (let i = 0; i < 14; i++) {
                const date = new Date();
                date.setDate(today.getDate() - (13 - i));
                aleksDates.push(date.toLocaleDateString('en-US', {month: 'short', day: 'numeric'}));
                // Minutes spent on ALEKS each day
                const minutes = student.type === 'struggling' ? Math.floor(Math.random() * 20) : 
                               student.type === 'average' ? 10 + Math.floor(Math.random() * 30) : 
                               20 + Math.floor(Math.random() * 50);
                aleksData.push(minutes);
            }
            
            // Generate outreach history
            const outreachHistory = [];
            const outreachTypes = ['Email', 'Text', 'Phone Call', 'In-person Meeting'];
            const outreachCount = 1 + Math.floor(Math.random() * 5); // 1-5 outreach attempts
            
            for (let i = 0; i < outreachCount; i++) {
                const daysAgo = Math.floor(Math.random() * 21); // 0-20 days ago
                const date = new Date();
                date.setDate(today.getDate() - daysAgo);
                
                outreachHistory.push({
                    type: outreachTypes[Math.floor(Math.random() * outreachTypes.length)],
                    date: date.toLocaleDateString('en-US', {month: 'short', day: 'numeric'}),
                    notes: `Discussed ${['progress', 'challenges', 'resources', 'goals'][Math.floor(Math.random() * 4)]}`
                });
            }
            
            // Sort outreach history by most recent first
            outreachHistory.sort((a, b) => new Date(b.date) - new Date(a.date));
            
            const content = `
                <h2 style="color: #2c3e50; margin-bottom: 20px;">${student.fullName} - Detailed Profile</h2>
                
                <div style="display: grid; grid-template-columns: repeat(auto-fit, minmax(250px, 1fr)); gap: 20px; margin-bottom: 30px;">
                    <div style="background: #f8f9fa; padding: 15px; border-radius: 10px;">
                        <h4 style="color: #2c3e50; margin-bottom: 10px;">Academic Performance</h4>
                        <p><strong>Current Grade:</strong> ${student.grade}%</p>
                        <p><strong>ALEKS Topics:</strong> ${student.aleksTopics} completed</p>
                        <p><strong>Last ALEKS Login:</strong> ${student.aleksDays} days ago</p>
                    </div>
                    
                    <div style="background: #f8f9fa; padding: 15px; border-radius: 10px;">
                        <h4 style="color: #2c3e50; margin-bottom: 10px;">Support Utilization</h4>
                        <p><strong>Think Tank Visits:</strong> ${student.thinkTankVisits} this month</p>
                        <p><strong>Overall Wellness:</strong> ${student.wellness}/100</p>
                        <p><strong>Status:</strong> <span style="color: ${student.status === 'green' ? '#27ae60' : student.status === 'yellow' ? '#f39c12' : '#e74c3c'}">${student.statusEmoji} ${student.status.charAt(0).toUpperCase() + student.status.slice(1)}</span></p>
                    </div>
                    
                    <div style="background: #f8f9fa; padding: 15px; border-radius: 10px;">
                        <h4 style="color: #2c3e50; margin-bottom: 10px;">Survey Insights</h4>
                        <p><strong>Overall Sentiment:</strong> ${student.sentimentScore}/10</p>
                        <p><strong>Stress Level:</strong> ${student.stress}/10</p>
                        <p><strong>Confidence Level:</strong> ${student.confidence}/10</p>
                    </div>
                </div>
                
                <div style="display: grid; grid-template-columns: repeat(auto-fit, minmax(300px, 1fr)); gap: 20px; margin-bottom: 30px;">
                    <div>
                        <h4 style="color: #2c3e50; margin-bottom: 15px;">Recent Survey Responses</h4>
                        <div style="background: #fff3cd; padding: 15px; border-radius: 10px; margin-bottom: 15px; border-left: 4px solid #ffc107;">
                            <h5 style="color: #856404; margin-bottom: 8px;">About Stress (${student.stress}/10):</h5>
                            <p style="font-style: italic; color: #6c757d; margin: 0;">"${student.stressQuote}"</p>
                        </div>
                        <div style="background: #d1ecf1; padding: 15px; border-radius: 10px; border-left: 4px solid #17a2b8;">
                            <h5 style="color: #0c5460; margin-bottom: 8px;">About Confidence (${student.confidence}/10):</h5>
                            <p style="font-style: italic; color: #6c757d; margin: 0;">"${student.confidenceQuote}"</p>
                        </div>
                    </div>
                    
                    <div>
                        <h4 style="color: #2c3e50; margin-bottom: 15px;">Outreach History</h4>
                        <div style="max-height: 200px; overflow-y: auto;">
                            ${outreachHistory.map(contact => `
                                <div style="background: #f8f9fa; padding: 10px; margin-bottom: 10px; border-radius: 8px; border-left: 3px solid #007bff;">
                                    <div style="display: flex; justify-content: space-between; align-items: center;">
                                        <strong style="color: #495057;">${contact.type}</strong>
                                        <span style="color: #6c757d; font-size: 0.9em;">${contact.date}</span>
                                    </div>
                                    <p style="margin: 5px 0 0 0; color: #6c757d; font-size: 0.9em;">${contact.notes}</p>
                                </div>
                            `).join('')}
                        </div>
                    </div>
                </div>
                
                <div style="display: grid; grid-template-columns: 1fr 1fr; gap: 20px; margin-bottom: 20px;">
                    <div>
                        <h4 style="color: #2c3e50; margin-bottom: 15px;">Class Attendance (Last 2 Weeks)</h4>
                        <canvas id="attendanceChart" style="max-height: 200px;"></canvas>
                    </div>
                    <div>
                        <h4 style="color: #2c3e50; margin-bottom: 15px;">ALEKS Activity (Minutes/Day)</h4>
                        <canvas id="aleksActivityChart" style="max-height: 200px;"></canvas>
                    </div>
                </div>
                
                <div style="display: flex; gap: 10px; justify-content: flex-end; margin-top: 20px;">
                    <button onclick="openStudentForm('${student.id}')" style="background: #27ae60; color: white; border: none; padding: 10px 20px; border-radius: 5px; cursor: pointer;">Edit Student</button>
<button onclick="logOutreach('${student.id}')" style="background: #007bff; color: white; border: none; padding: 10px 20px; border-radius: 5px; cursor: pointer;">Log New Contact</button>
<button onclick="closeStudentProfile()" style="background: #6c757d; color: white; border: none; padding: 10px 20px; border-radius: 5px; cursor: pointer;">Close</button>
                </div>
            `;
            
            document.getElementById('studentProfileContent').innerHTML = content;
            document.getElementById('studentProfileModal').style.display = 'block';
            
            // Create attendance chart
            setTimeout(() => {
                const attendanceCtx = document.getElementById('attendanceChart');
                if (attendanceCtx) {
                    new Chart(attendanceCtx.getContext('2d'), {
                        type: 'bar',
                        data: {
                            labels: attendanceDates,
                            datasets: [{
                                label: 'Attended',
                                data: attendanceData,
                                backgroundColor: attendanceData.map(val => val === 1 ? '#27ae60' : '#e74c3c'),
                                borderRadius: 3
                            }]
                        },
                        options: {
                            responsive: true,
                            maintainAspectRatio: false,
                            plugins: {
                                legend: { display: false }
                            },
                            scales: {
                                y: {
                                    beginAtZero: true,
                                    max: 1,
                                    ticks: {
                                        callback: function(value) {
                                            return value === 1 ? 'Present' : 'Absent';
                                        }
                                    }
                                }
                            }
                        }
                    });
                }
                
                // Create ALEKS activity chart
                const aleksActivityCtx = document.getElementById('aleksActivityChart');
                if (aleksActivityCtx) {
                    new Chart(aleksActivityCtx.getContext('2d'), {
                        type: 'line',
                        data: {
                            labels: aleksDates,
                            datasets: [{
                                label: 'Minutes',
                                data: aleksData,
                                borderColor: '#3498db',
                                backgroundColor: 'rgba(52, 152, 219, 0.1)',
                                fill: true,
                                tension: 0.4
                            }]
                        },
                        options: {
                            responsive: true,
                            maintainAspectRatio: false,
                            plugins: {
                                legend: { display: false }
                            },
                            scales: {
                                y: {
                                    beginAtZero: true,
                                    title: {
                                        display: true,
                                        text: 'Minutes'
                                    }
                                }
                            }
                        }
                    });
                }
            }, 100);
        }

        // Close student profile modal
        function closeStudentProfile() {
            document.getElementById('studentProfileModal').style.display = 'none';
        }

        // Log new outreach contact
        function logOutreach(studentId) {
            const student = students.find(s => s.id === studentId);
            if (!student) return;
            
            const contactType = prompt('Contact type (Email/Text/Phone Call/In-person Meeting):');
            const notes = prompt('Notes about the contact:');
            
            if (contactType && notes) {
                alert(`Outreach logged for ${student.fullName}:\nType: ${contactType}\nNotes: ${notes}`);
                // In a real implementation, this would save to a database
            }
        }
        function toggleView(view) {
    currentView = view;
    displayStudents(currentFilter);

    // Update button styles
    document.getElementById('listViewBtn').classList.remove('filter-active');
    document.getElementById('listViewBtn').classList.add('filter-inactive');
    document.getElementById('gridViewBtn').classList.remove('filter-active');
    document.getElementById('gridViewBtn').classList.add('filter-inactive');

    if(view === 'list') {
        document.getElementById('listViewBtn').classList.add('filter-active');
        document.getElementById('listViewBtn').classList.remove('filter-inactive');
    } else {
        document.getElementById('gridViewBtn').classList.add('filter-active');
        document.getElementById('gridViewBtn').classList.remove('filter-inactive');
    }
}
// Open Student Form (for Add or Edit)
function openStudentForm(studentId = null) {
    const form = document.getElementById('studentForm');
    const title = document.getElementById('studentFormTitle');
    form.reset();

    if (studentId) {
        // Editing existing student
        const student = students.find(s => s.id === studentId);
        if (!student) return;
        title.textContent = "Edit Student";
        document.getElementById('formStudentId').value = student.id;
        document.getElementById('formFirstName').value = student.firstName;
        document.getElementById('formLastName').value = student.lastName;
        document.getElementById('formGrade').value = student.grade;
        document.getElementById('formAleksDays').value = student.aleksDays;
        document.getElementById('formAleksTopics').value = student.aleksTopics;
        document.getElementById('formThinkTankVisits').value = student.thinkTankVisits;
        document.getElementById('formStress').value = student.stress;
        document.getElementById('formConfidence').value = student.confidence;
        document.getElementById('formWellness').value = student.wellness;
    } else {
        // Adding new student
        title.textContent = "Add Student";
        document.getElementById('formStudentId').value = '';
    }

    document.getElementById('studentFormModal').style.display = 'block';
}

// Close Student Form Modal
function closeStudentForm() {
    document.getElementById('studentFormModal').style.display = 'none';
}

// Save Student (add or edit)
function saveStudent(event) {
    event.preventDefault();
    const id = document.getElementById('formStudentId').value;
    const firstName = document.getElementById('formFirstName').value;
    const lastName = document.getElementById('formLastName').value;
    const grade = Number(document.getElementById('formGrade').value);
    const aleksDays = Number(document.getElementById('formAleksDays').value);
    const aleksTopics = Number(document.getElementById('formAleksTopics').value);
    const thinkTankVisits = Number(document.getElementById('formThinkTankVisits').value);
    const stress = Number(document.getElementById('formStress').value);
    const confidence = Number(document.getElementById('formConfidence').value);
    const wellness = Number(document.getElementById('formWellness').value);

    // Set status and emoji
    const status = wellness >= 80 ? 'green' : wellness >= 60 ? 'yellow' : 'red';
    const statusEmoji = status === 'green' ? '🟢' : status === 'yellow' ? '🟡' : '🔴';
    const type = (wellness < 60 || grade < 70) ? 'struggling' : wellness > 85 ? 'excelling' : 'average';
    const sentimentScore = Math.max(1, Math.min(10, (11 - stress + confidence) / 2));

    if (id) {
        // Edit student
        const idx = students.findIndex(s => s.id === id);
        if (idx > -1) {
            students[idx] = {
                ...students[idx],
                firstName,
                lastName,
                fullName: `${firstName} ${lastName}`,
                grade,
                aleksDays,
                aleksTopics,
                thinkTankVisits,
                stress,
                confidence,
                wellness,
                status,
                statusEmoji,
                type,
                sentimentScore
            };
        }
    } else {
        // Add new student
        const newId = `UA${1000 + students.length + 1}`;
        students.push({
            id: newId,
            firstName,
            lastName,
            fullName: `${firstName} ${lastName}`,
            grade,
            aleksDays,
            aleksTopics,
            thinkTankVisits,
            stress,
            confidence,
            wellness,
            status,
            statusEmoji,
            type,
            sentimentScore
        });
    }

    closeStudentForm();
    updateStats();
    createCharts();
    displayStudents(currentFilter);
}

// (Removed old timelineEvents, outreachBlocks, semesterStart, semesterEnd, and old getTimelinePercent)

function initializeDashboard() {
    updateStats();
    createCharts();
    displayStudents();
    document.getElementById('lastUpdated').textContent = new Date().toLocaleString();
}
const milestoneTimelineEvents = [
  { date: "2024-08-19", label: "Classes Start", type: "registration" },
  { date: "2024-08-23", label: "Last Day to Add/Drop", type: "registration" },
  { date: "2024-09-02", label: "Labor Day", type: "holiday" },
  { date: "2024-09-16", label: "Golden Outreach", type: "outreach", outreachBand: { end: "2024-09-20" }},
  { date: "2024-10-07", label: "Midterms Begin", type: "exam" },
  { date: "2024-10-14", label: "Fall Break", type: "holiday" },
  { date: "2024-11-04", label: "Pre-Reg/Advising", type: "registration" },
  { date: "2024-11-28", label: "Thanksgiving", type: "holiday" },
  { date: "2024-12-09", label: "Finals Week", type: "exam" },
  { date: "2024-12-13", label: "Semester Ends", type: "exam" }
];
const milestoneOutreachBands = [
  { start: "2024-09-16", end: "2024-09-20" },
  { start: "2024-10-07", end: "2024-10-11" },
  { start: "2024-11-04", end: "2024-11-08" }
];
function getTimelinePercent(date) {
  const timelineStart = new Date("2024-08-19");
  const timelineEnd = new Date("2024-12-13");
  const timelineLength = (timelineEnd - timelineStart) / (1000 * 60 * 60 * 24);
  const curr = (new Date(date) - timelineStart) / (1000 * 60 * 60 * 24);
  return Math.max(0, Math.min(1, curr / timelineLength));
}

function renderMilestoneTimeline(filter = 'all') {
  const container = document.getElementById('milestoneTimeline');
  container.innerHTML = '';

  // dynamically size timeline to semester length
  const semesterStart = new Date("2024-08-19");
  const semesterEnd = new Date("2024-12-13");
  const days = (semesterEnd - semesterStart) / (1000 * 60 * 60 * 24);
  const weeks = days / 7;
  const pxPerWeek = 100;
  container.style.width = Math.max(weeks * pxPerWeek, 900) + 'px';

  // Add the solid background track first (always present, always visible)
  const track = document.createElement('div');
  track.className = 'timeline-track';
  container.appendChild(track);

  // Highlight current week position
  const totalMs = semesterEnd - semesterStart;
  const now = new Date();
  const currPerc = ((now - semesterStart) / totalMs) * 100;
  const currentLine = document.createElement('div');
  currentLine.className = 'timeline-tick current';
  currentLine.style.left = currPerc + '%';
  container.appendChild(currentLine);

  // Add outreach bands (appear above the track)
  milestoneOutreachBands.forEach(band => {
    if (filter !== 'all' && filter !== 'outreach') return;
    const left = getTimelinePercent(band.start) * 100;
    const width = (getTimelinePercent(band.end) - getTimelinePercent(band.start)) * 100;
    const bandDiv = document.createElement('div');
    bandDiv.className = 'timeline-band';
    bandDiv.style.left = left + '%';
    bandDiv.style.width = width + '%';
    container.appendChild(bandDiv);
  });

  // Add event dots (centered on the bar)
  milestoneTimelineEvents.forEach(event => {
    if (filter !== 'all' && filter !== event.type) return;
    const percent = getTimelinePercent(event.date) * 100;
    const dot = document.createElement('div');
    dot.className = 'timeline-dot ' + event.type;
    dot.style.left = percent + '%';
    dot.onclick = () => alert(`${event.label}\n${event.date}`);
    dot.textContent = event.type === "exam" ? "📝" : event.type === "holiday" ? "🏖️" : event.type === "outreach" ? "⭐" : event.type === "registration" ? "🎓" : "🔹";
    // Create popover
    const pop = document.createElement('div');
    pop.className = 'popover';
    pop.textContent = `${event.label} (${event.date})`;
    dot.appendChild(pop);
    container.appendChild(dot);
  });
}
let currentTimelineFilter = 'all';
function filterTimelineEvents(type) {
  // If called from old select (should not happen), fallback
  if (typeof type !== 'string') {
    type = currentTimelineFilter || 'all';
  }
  currentTimelineFilter = type;
  renderMilestoneTimeline(type);
}
// Add custom event (simple demo)
function addCustomTimelineEvent() {
  const label = prompt('Event name?');
  const date = prompt('Date (YYYY-MM-DD)?');
  if (label && date) {
    milestoneTimelineEvents.push({ date, label, type: 'custom' });
    renderMilestoneTimeline(currentTimelineFilter);
  }
}

// Drag and wheel scroll on timeline wrapper
(function() {
  const wrapper = document.getElementById('milestoneTimelineWrapper');
  let isDown = false, startX, scrollLeft;
  wrapper.addEventListener('mousedown', e => {
    isDown = true;
    wrapper.classList.add('dragging');
    startX = e.pageX - wrapper.offsetLeft;
    scrollLeft = wrapper.scrollLeft;
  });
  ['mouseleave', 'mouseup'].forEach(evt =>
    wrapper.addEventListener(evt, () => { isDown = false; wrapper.classList.remove('dragging'); })
  );
  wrapper.addEventListener('mousemove', e => {
    if (!isDown) return;
    e.preventDefault();
    const x = e.pageX - wrapper.offsetLeft;
    const walk = (x - startX) * 1.5;
    wrapper.scrollLeft = scrollLeft - walk;
  });
  wrapper.addEventListener('wheel', e => {
    wrapper.scrollLeft += e.deltaY;
    e.preventDefault();
  }, { passive: false });
  // Touch events
  wrapper.addEventListener('touchstart', e => {
    startX = e.touches[0].pageX - wrapper.offsetLeft;
    scrollLeft = wrapper.scrollLeft;
  });
  wrapper.addEventListener('touchmove', e => {
    e.preventDefault();
    const x = e.touches[0].pageX - wrapper.offsetLeft;
    const walk = (x - startX) * 1.5;
    wrapper.scrollLeft = scrollLeft - walk;
  }, { passive: false });
})();

function updateTimelineControls(activeBtn) {
  document.querySelectorAll('.timeline-controls .filter-button').forEach(btn => {
    btn.classList.remove('filter-active');
    btn.classList.add('filter-inactive');
  });
  activeBtn.classList.remove('filter-inactive');
  activeBtn.classList.add('filter-active');
}

// Only call renderMilestoneTimeline ONCE on DOMContentLoaded, after dashboard is set up
document.addEventListener('DOMContentLoaded', () => {
  initializeDashboard();
  renderMilestoneTimeline(currentTimelineFilter);
});
    </script>
</body>
</html>